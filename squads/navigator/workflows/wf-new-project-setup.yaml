---
workflow:
  name: New Project Setup
  id: nav-wf-001
  description: Complete workflow for mapping and starting a new AIOS project
  version: 1.0.0
  executor: "@navigator"

metadata:
  author: Navigator Squad
  created: 2026-02-15
  tags:
    - new-project
    - onboarding
    - roadmap

veto_conditions:
  step_1_map_project:
    - "No git repository in project root → BLOCK (run git init first)"
    - "Roadmap already exists for this project → WARN (suggest *update-roadmap instead)"
  step_3_create_checkpoint:
    - "Roadmap file not generated by Step 1 → BLOCK (cannot checkpoint without roadmap)"
  step_4_detect_phase:
    - "Pipeline map missing or invalid YAML → BLOCK (run *navigator-doctor to fix)"
  step_5_delegate:
    - "No valid agent identified for next phase → BLOCK (check pipeline map agent assignments)"
    - "Target agent not available in AIOS registry → BLOCK (verify agent installation)"

steps:
  - id: 1
    name: Map Project
    task: nav-map-project
    executor: "@navigator"
    inputs:
      - project_description
    outputs:
      - roadmap_file: .aios/navigator/{project-name}/roadmap.md
      - local_roadmap: docs/roadmap.md
    on_success: next
    on_failure: abort

  - id: 2
    name: Verify Roadmap
    task: manual-verification
    executor: human
    description: |
      Review the generated roadmap:
      - Check phase sequence makes sense
      - Verify agent assignments are correct
      - Confirm output patterns match your project structure
    inputs:
      - roadmap_file
    on_success: next
    on_skip: next

  - id: 3
    name: Create Initial Checkpoint
    task: nav-checkpoint
    executor: "@navigator"
    inputs:
      - phase: 0
      - type: manual
      - description: "Initial project setup"
    outputs:
      - checkpoint_file
    on_success: next
    on_failure: warn

  - id: 4
    name: Detect Starting Phase
    task: nav-where-am-i
    executor: "@navigator"
    inputs: []
    outputs:
      - current_phase
      - next_agent
      - next_command
    on_success: next

  - id: 5
    name: Delegate to First Agent
    task: nav-auto-navigate
    executor: "@navigator"
    inputs:
      - current_phase
    outputs:
      - activation_command
    on_success: complete

completion:
  message: |
    ✅ New project setup complete!

    Your roadmap is ready at: {roadmap_file}

    Next steps:
    1. Run the suggested command: {activation_command}
    2. Begin development following the roadmap
    3. Use *where-am-i to check progress anytime

  next_actions:
    - command: "{activation_command}"
      description: "Start development with first phase"
    - command: "*where-am-i"
      description: "Check current progress"
