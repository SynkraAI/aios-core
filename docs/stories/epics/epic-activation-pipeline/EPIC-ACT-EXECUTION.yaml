# ============================================
# EPIC-ACT Execution Plan
# Project-specific orchestration for the
# Unified Agent Activation Pipeline epic.
#
# Uses: epic-orchestration template (framework)
# Inner loop: development-cycle (per story)
#
# Location: docs/stories/epics/epic-activation-pipeline/
# This file is PROJECT-SPECIFIC, not framework-level.
# ============================================

execution:
  epicId: EPIC-ACT
  epicIndex: docs/stories/epics/epic-activation-pipeline/EPIC-ACT-INDEX.md
  storyBasePath: docs/stories/epics/epic-activation-pipeline
  template: epic-orchestration   # Framework template in .aios-core/development/workflows/

  # ═══════════════════════════════════════════════════════════════════════════════════
  #                              STORIES
  # ═══════════════════════════════════════════════════════════════════════════════════

  stories:

    ACT-1:
      file: story-act-1-greeting-preference-fix.md
      title: "Fix GreetingPreferenceManager Configuration"
      executor: dev
      quality_gate: architect
      complexity: low
      priority: critical
      branch: feat/act-1-greeting-config
      key_files:
        - .aios-core/core-config.yaml
        - .aios-core/development/scripts/greeting-preference-manager.js

    ACT-2:
      file: story-act-2-user-profile-audit.md
      title: "Audit user_profile Impact Across Agents"
      executor: dev
      quality_gate: architect
      complexity: medium
      priority: high
      branch: feat/act-2-user-profile-audit
      key_files:
        - .aios-core/development/scripts/greeting-builder.js
        - .aios-core/infrastructure/scripts/validate-user-profile.js

    ACT-3:
      file: story-act-3-project-status-reliability.md
      title: "ProjectStatusLoader Reliability Overhaul"
      executor: dev
      quality_gate: architect
      complexity: high
      priority: high
      branch: feat/act-3-status-loader-reliability
      key_files:
        - .aios-core/infrastructure/scripts/project-status-loader.js

    ACT-4:
      file: story-act-4-permission-mode-integration.md
      title: "PermissionMode Integration Fix"
      executor: dev
      quality_gate: architect
      complexity: high
      priority: high
      branch: feat/act-4-permission-mode
      key_files:
        - .aios-core/core/permissions/permission-mode.js
        - .aios-core/core/permissions/operation-guard.js
        - .aios-core/development/tasks/environment-bootstrap.md

    ACT-5:
      file: story-act-5-workflow-navigator-bob.md
      title: "WorkflowNavigator + Bob Integration"
      executor: dev
      quality_gate: architect
      complexity: high
      priority: medium
      branch: feat/act-5-workflow-navigator
      external_dependencies:
        - "Epic 11 Stories 11.4, 11.5 (optional - implement basic fix first)"
      key_files:
        - .aios-core/development/scripts/workflow-navigator.js
        - .aios-core/development/scripts/greeting-builder.js
        - .aios-core/data/workflow-patterns.yaml

    ACT-6:
      file: story-act-6-unified-activation-pipeline.md
      title: "Unified Activation Pipeline"
      executor: dev
      quality_gate: architect
      complexity: very_high
      priority: high
      branch: feat/act-6-unified-pipeline
      note: "THE CORE STORY - builds on all Wave 1 outputs"
      key_files:
        - .aios-core/development/scripts/greeting-builder.js
        - .aios-core/development/scripts/generate-greeting.js
        - All 12 agent .md files in .aios-core/development/agents/

    ACT-7:
      file: story-act-7-context-aware-greetings.md
      title: "Context-Aware Greeting Sections"
      executor: dev
      quality_gate: architect
      complexity: high
      priority: medium
      branch: feat/act-7-context-greetings
      key_files:
        - .aios-core/development/scripts/greeting-builder.js

    ACT-8:
      file: story-act-8-config-governance.md
      title: "Agent Config Loading + Document Governance"
      executor: dev
      quality_gate: architect
      complexity: medium
      priority: medium
      branch: feat/act-8-config-governance
      key_files:
        - .aios-core/data/agent-config-requirements.yaml
        - .aios-core/product/data/source-tree.md

  # ═══════════════════════════════════════════════════════════════════════════════════
  #                              WAVES
  # ═══════════════════════════════════════════════════════════════════════════════════
  #
  # Each wave runs stories in parallel via development-cycle:
  #   Per story: @po validates → ${executor} develops → self-healing →
  #              ${quality_gate} reviews → @devops pushes branch
  #   Wave gate: Integration review → merge branches → checkpoint

  waves:

    # ─────────────────────────────────────────────────────────────────────
    # WAVE 1: Foundation Fixes
    # No inter-dependencies - all 4 stories can execute simultaneously
    # ─────────────────────────────────────────────────────────────────────
    - wave: 1
      name: "Foundation Fixes"
      parallel: true
      stories: [ACT-1, ACT-2, ACT-3, ACT-4]
      dependencies: []

      gate:
        agent: architect
        focus: |
          - ACT-3 cache design is sound (event-driven, file-locked, worktree-aware)
          - ACT-4 permission integration doesn't create coupling
          - Changes are backward-compatible with existing activation paths
          - Foundation is solid for ACT-6 unification to build upon

      merge:
        order: [ACT-1, ACT-2, ACT-3, ACT-4]  # Low conflict risk, any order works
        conflict_risk: low
        notes: |
          ACT-1 ↔ ACT-2: LOW (both touch core-config.yaml but different sections)
          ACT-1 ↔ ACT-3: NONE (different files)
          ACT-1 ↔ ACT-4: LOW (both touch agent files but different aspects)
          ACT-2 ↔ ACT-3: NONE (different subsystems)
          ACT-2 ↔ ACT-4: LOW (both modify agents but different features)
          ACT-3 ↔ ACT-4: NONE (infrastructure vs permissions)

      tag: wave-1-complete

    # ─────────────────────────────────────────────────────────────────────
    # WAVE 2: Unification
    # Depends on ALL Wave 1 stories merged to main
    # ─────────────────────────────────────────────────────────────────────
    - wave: 2
      name: "Unification"
      parallel: false  # Single story
      stories: [ACT-6]
      dependencies: [wave-1]

      gate:
        agent: architect
        focus: |
          COMPREHENSIVE - this is the core architectural change:
          - ALL 12 agents activate through unified path
          - Context richness identical across all agents
          - Parallel loading runs correctly (<100ms target)
          - Backward compatibility with existing buildGreeting() API
          - Error fallback to static greeting on failure

          Test matrix: Activate all 12 agents individually and verify context.

      merge:
        order: [ACT-6]
        conflict_risk: none  # Single branch
      tag: wave-2-complete

    # ─────────────────────────────────────────────────────────────────────
    # WAVE 3: Intelligence & Governance
    # All depend on ACT-6 but independent of each other
    # ─────────────────────────────────────────────────────────────────────
    - wave: 3
      name: "Intelligence & Governance"
      parallel: true
      stories: [ACT-5, ACT-7, ACT-8]
      dependencies: [wave-2]

      gate:
        agent: architect
        focus: |
          - All 7 original bugs confirmed fixed
          - WorkflowNavigator suggestions are useful (not just pattern matches)
          - Context-aware greetings improve experience vs static
          - Config governance established and documented
          - No regressions from Wave 3 additions

      merge:
        order: [ACT-8, ACT-5, ACT-7]  # Minimize conflicts on greeting-builder.js
        conflict_risk: medium
        notes: |
          ACT-5 ↔ ACT-7: MEDIUM (both modify greeting-builder.js)
          ACT-5 ↔ ACT-8: LOW (different subsystems)
          ACT-7 ↔ ACT-8: LOW (greeting vs config)

          Recommended merge order:
          1. ACT-8 first (config/governance - least overlap)
          2. ACT-5 second (workflow-navigator - modifies greeting-builder)
          3. ACT-7 last (context greetings - also modifies greeting-builder)

      tag: wave-3-complete

  # ═══════════════════════════════════════════════════════════════════════════════════
  #                              FINAL GATE
  # ═══════════════════════════════════════════════════════════════════════════════════

  final_gate:
    agent: architect
    focus: |
      Epic-level sign-off:
      - All 8 stories done, all 7 bugs confirmed fixed
      - All 12 agents activate through unified pipeline
      - Performance targets met (<100ms activation)
      - Architecture is clean, maintainable, extensible
    tag: epic-act-complete

  retrospective:
    agent: po
    optional: true
    output: EPIC-ACT-RETROSPECTIVE.md
    metrics:
      - Actual vs estimated time per story
      - Parallel efficiency (wall-time saved vs sequential)
      - Quality gate findings summary
      - Conflict resolution effort per wave

  # ═══════════════════════════════════════════════════════════════════════════════════
  #                              BUG VERIFICATION CHECKLIST
  # ═══════════════════════════════════════════════════════════════════════════════════

  bug_verification:
    - bug: 1
      description: "preference key missing from core-config.yaml"
      fixed_by: ACT-1
      verify: "agentIdentity.greeting.preference exists in core-config.yaml"

    - bug: 2
      description: "PermissionMode not connected to execution layer"
      fixed_by: ACT-4
      verify: "OperationGuard.checkOperation() called before destructive ops"

    - bug: 3
      description: "Sequential context loading in _buildContextualGreeting()"
      fixed_by: ACT-6
      verify: "Promise.all() used for parallel loading, <100ms"

    - bug: 4
      description: "WorkflowNavigator dead (wrong method + narrow conditions)"
      fixed_by: ACT-5
      verify: "suggestNextCommands() called, conditions relaxed"

    - bug: 5
      description: "ProjectStatusLoader 60s cache always stale"
      fixed_by: ACT-3
      verify: "Event-driven invalidation, updates within 5s after commit"

    - bug: 6
      description: "Path A vs Path B inconsistent context richness"
      fixed_by: ACT-6
      verify: "All 12 agents use UnifiedActivationPipeline"

    - bug: 7
      description: "7 critical data files missing from source-tree.md"
      fixed_by: ACT-8
      verify: "All 7 files added with owner and fill rule"

# ═══════════════════════════════════════════════════════════════════════════════════
#                              METADATA
# ═══════════════════════════════════════════════════════════════════════════════════

metadata:
  epic: EPIC-ACT
  created: "2026-02-06"
  author: "@pm (Bob)"
  source:
    - AIOS-TRACE-001
    - AIOS-XREF-001
  template: epic-orchestration
  inner_workflow: development-cycle
